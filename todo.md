# Math Mentor - プロジェクトTODO

## フェーズ1：プロジェクトのセットアップと基本設計
- [x] 技術スタックの確認と環境構築
- [x] グラフ描画ライブラリの選定（Recharts - 既にインストール済み）
- [x] プロジェクト構造の整理

## フェーズ2：データベース設計とAPIエンドポイントの実装
- [x] learning_sessionsテーブルの設計と作成
- [x] chat_logsテーブルの設計と作成
- [x] ER図の作成
- [x] セッション開始エンドポイント（POST /api/sessions）の実装
- [x] AI対話エンドポイント（POST /api/chat）の実装
- [x] セッション取得エンドポイント（GET /api/sessions/:id）の実装

## フェーズ3：AI数学メンター機能の実装
- [x] Manus LLM APIの統合
- [x] トピック入力フォームの実装
- [x] AI応答生成ロジックの実装
- [x] 数式・定義リスト・箇条書きの適切なフォーマット
- [x] チャットUI/UXの実装

## フェーズ4：グラフ生成機能の実装
- [x] グラフ描画ライブラリの統合
- [x] AIによるグラフデータ生成ロジック
- [x] 動的グラフレンダリング機能
- [x] パラメータ変更時の動的更新

## フェーズ5：Web検索機能と思考実験機能の実装
- [x] Manus Web検索APIの統合
- [x] 複雑な質問への対応機能
- [x] 思考実験・シナリオ分析機能の実装
- [x] 複数シナリオの提示と解説

## フェーズ6：セッション復元機能とレスポンシブデザインの実装
- [x] localStorageでのセッションID保存機能
- [x] セッション復元ロジック
- [x] チャット履歴の復元
- [x] モバイルレスポンシブデザイン
- [x] デスクトップ対応

## フェーズ7：テストとデプロイ
- [x] 単体テストの実装
- [x] 結合テストの実装
- [x] デプロイ準備
- [x] 本番環境での動作確認

## 新規u8981件：Manus LLM API統合と拡張機能
- [x] Manus LLM APIの実装確認と修a正
- [x] 練習問題機能の実装
- [x] クu30a3ズ機能の実装
- [x] 演習問題機能の実装
- [x] 学習ノート機能の実装
- [x] PDFダウンロード機能の実装
- [x] テキストエクスポート機能の実装
- [x] 最終テストとデプロイ

## UI 修正：学習機能の表示改善
- [x] 練習問題・クイズ生成結果を会話ボックスに統合表示
- [x] LearningTabs コンポーネントの表示方法を改善
- [x] AI 生成結果をメッセージとして会話履歴に追加


## 緗急修正：AI 回答ボックス表示問題
- [x] AI 回答ボックスが背面に隠れる問題を修正
- [x] z-index とレイアウト構造の改善
- [x] スクロール領域の修正


## バグ修正：クイズ・練習問題生成エラー
- [x] React Context エラーを修正
- [x] tRPC クライアント初期化の確認
- [x] LearningTabs コンポーネントの Context 依存性を修正
- [x] useState インポートを追加して修正完了


## 緗急：クイズ・練習問題生成機能の完全修正
- [x] LearningTabs コンポーネントの完全な再実装
- [x] tRPC mutation エラーハンドリングの改善
- [x] API レスポンスの検証と修正


## 新機能：難易度適応型問題生成
- [x] 正解率トラッキング機能の実装
- [x] 難易度自動調整ロジックの実装
- [x] UIで難易度表示の改善
- [x] テスト実装と動作確認


## 緗急修正：クイズ・練習問題生成機能の完全実装
- [x] React Context エラーの完全修正
- [x] クイズ・練習問題の生成と表示機能
- [x] ユーザー回答入力機能
- [x] AI 指導フローの実装
- [x] UI/UX の改善


## 新機能：練習問題の AI 解答欄への出力と数式表示の改善
- [x] 練習問題を AI 解答欄に出力する機能
- [x] LaTeX 形式の数式を美しく表示する機能
- [x] Streamdown コンポーネントで数式をレンダリング
- [x] 学生が回答を入力して送信できる機能


## 緊急修正：練習問題表示問題と数式レンダリング改善
- [x] 練習問題が Chat 欄に表示されない問題を修正
- [x] learning.ts の generatePracticeProblems エンドポイントのプロンプト改善
- [x] テンプレートリテラルの構文エラーを修正
- [x] AI コメントのマークダウン数式表示が正常に動作
- [x] Streamdown コンポーネントで複数の数式形式に対応


## 修正：AI コメント数式表示と選択肖表示の改善
- [x] AI の通常コメント内のマークダウン数式を Streamdown でレンダリング
- [x] クイズ・練習問題の選択肖を「(A), (B), (C)」から「(A), (B), (C)」に変更
- [x] LLM プロンプトで選択肖フォーマットを指定
- [x] UI での選択肖表示を確認

## 緗急修正：AI 通常コメント内の数式レンダリング問題
- [x] AI の通常コメント内のマークダウン数式（$...$）が正しくレンダリングされていることを確認
- [x] Streamdown コンポーネントが LaTeX 形式の数式を正しく処理していることを確認
- [x] AIChatBox コンポーネントの数式レンダリング処理は正しく動作していることを確認
- [x] ブラウザでテストして、数式が正しく表示されることを確認


## 修正：AI コメント数式記法の削除と学習成績タブの自動アップデート
- [x] AI の通常コメントで数式記法（$, LaTeX, 数学記号）を使わないようプロンプトを修正
- [x] chat ルーターの sendMessage エンドポイントのプロンプトを修正
- [x] 学習成績タブの自動アップデート機能を実装
- [x] クイズ・練習問題の解答データをデータベースに保存
- [x] 成績計算ロジックを実装（正答率、解いた問題数など）
- [x] UI で成績データを表示
- [x] ブラウザでテストして、成績が正しく更新されることを確認

## 新機能：成績トラッキング機能の完全実装
- [x] chat.ts に detectAnswerCorrectness() 関数を追加
- [x] sendMessage エンドポイントで正誤判定を自動検出
- [x] updateSessionPerformance を自動呼び出し
- [x] evaluateAnswer エンドポイントを新規追加
- [x] Home.tsx の sendMessage 処理を改善
- [x] LearningTabs.tsx で成績データを自動更新（refetchInterval: 1000）
- [x] ブラウザテストで成績が正しく更新されることを確認
- [x] 複数問題の回答で成績が累積更新されることを確認

## バグ修正：クイズの設問番号がダブる問題
- [x] クイズ生成ロジックを確認して、設問番号がダブる原因を特定
- [x] クイズ生成ロジックを修正して、設問番号が正しく付与されるようにする（プロンプト修正）
- [x] ブラウザでテストして、設問番号が正しく表示されることを確認

## SEO 問題の修正
- [x] キーワードメタタグを追加
- [x] H1 見出しを追加
- [x] H2 見出しを追加
- [x] タイトルを 30〜60 文字に修正（36文字）
- [x] メタディスクリプションを 50〜160 文字で追加（79文字）
- [x] ブラウザでテストして SEO 問題が解決されたことを確認

## OGP 画像の設定
- [x] Math Mentor に相応しい OGP 画像を生成（2752x1536px）
- [x] 画像をプロジェクトの public フォルダに保存（og-image.png）
- [x] index.html に OGP メタタグを追加（Open Graph + Twitter Card）
- [x] ブラウザでテストして OGP 画像が正しく設定されたことを確認

## バグ修正：クイズ・練習問題で LaTeX 記法がそのまま表示される問題
- [x] クイズ・練習問題生成のプロンプトを確認
- [x] プロンプトを修正して LaTeX 記法を使わないよう指示（平文で数式を表現）
- [x] ブラウザでテストして修正を確認（三角関数クイズで検証済み）

## バグ修正：通常 AI 回答で LaTeX 記法がそのまま表示される問題
- [x] chat.ts のプロンプトを確認
- [x] プロンプトを修正して LaTeX 記法を使わないよう指示（CRITICAL FORMATTING RULES を追加）
- [x] ブラウザでテストして修正を確認（三角関数の学習で検証済み）

## バグ修正：成績評価ロジックの問題（間違えても正解数が増える）
- [x] 成績評価ロジックの現状を確認（chat.ts, learning.ts, Home.tsx）
- [x] 正誤判定ロジックを修正（不正解パターンを先にチェック、「正解は」パターンで比較）
- [x] クイズと練習問題の両方で成績が正しく記録されるよう修正（submitQuizAnswer エンドポイント追加）
- [x] ブラウザでテストして修正を確認（間違えた場合に正解数 0、正答率 0% を確認）

## バグ修正：AI 回答で ** 太字記法がそのまま表示される問題
- [x] chat.ts のプロンプトを確認して ** 記法を禁止する指示を追加
- [x] ブラウザでテストして修正を確認（三角関数の学習で検証済み）
